@{
    ViewData["Title"] = "Course Edit";
}

<h3>Edit Course</h3>
<form method="post" asp-controller="Course" asp-action="EditCourseBody">
    <input type="hidden" value="@ViewBag.CourseId" name="Id" />
    <div class="form-group">
        <label for="Title">Course Name</label>
        <input type="text" class="form-control" id="Title" name="Title" value="@Model.Title">
    </div>
    <div class="form-group">
        <label for="Сategory">Сategory</label>
        <input type="text" class="form-control" id="Сategory" name="Сategory" value="@Model.Сategory">
    </div>
    <div class="form-group">
        <label for="Price">Price</label>
        <input type="text" class="form-control" id="Price" name="Price" value="@Model.Price">
    </div>
    <div class="form-group">
        <label for="Description">Description</label>
        <textarea class="form-control" id="Description" name="Description" rows="3">@Model.Description</textarea>
    </div>
    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input type="submit" class="btn btn-secondary" value="Edit" />
        </div>
    </div>
</form>

<form method="post" asp-controller="Course" asp-action="AddLinkedCourse">
    <input type="hidden" value="@ViewBag.CourseId" name="Id" />
    <div class="input-group">
        <select class="form-control" name="LinkedCourseId" id="dropdownLinkedCourse"></select>
        <input type="submit" class="btn btn-secondary" value="Link" />
    </div>
</form>


<h3>Linked Courses</h3>
<table class="table-condensed">
    <tr>
        <td>Course</td>
        <td>Action</td>
    </tr>
    @if (Model.LinkedCourses != null)
    {
        foreach (var linkedCourse in Model.LinkedCourses)
        {
            <tr>
                <td>@linkedCourse.LinkedCourse.Title</td>
                <td>
                    <form method="post" asp-controller="Course" asp-action="UnlinkCourse">
                        <input type="hidden" value="@linkedCourse.LinkedCourse.Id" name="UnlinkCourseId" />
                        <input type="hidden" value="@ViewBag.CourseId" name="Id" />
                        <button class="btn btn-secondary" type="submit">Unlink</button>
                    </form>
                </td>
            </tr>
        }
    }
</table>

<h3>Lessons</h3>
<form method="post" asp-controller="Course" asp-action="EditCourseLessons" , asp-route-id="@Model.Id">
    <div class="btn-group" role="group" aria-label="Admin buttons">
        <a type="button" onclick="location.href='@Url.Action("Create", "Lesson", new { Id = Model.Id })'" value="Create" class="btn btn-secondary" style="color: white;">Create</a>
        <button type="submit" name="submitbutton" value="Edit" class="btn btn-secondary">Edit</button>
        <button type="submit" name="submitbutton" value="Delete" class="btn btn-secondary">Delete</button>
    </div>

    <table class="table-condensed">
        @if (Model.Lessons != null)
        {
            foreach (var Lesson in Model.Lessons)
            {
                <tr>
                    <td>
                        <input name="AreChecked" type="checkbox" value="@Lesson.Id" />
                    </td>
                    <td>@Lesson.Title</td>
                    <td>@Lesson.CreatedBy</td>
                    <td>@Lesson.LastUpdated</td>
                </tr>
            }
        }
    </table>
</form>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var courseDropdown = $("#dropdownLinkedCourse");
        $.ajax({
            type: "POST",
            url: "/Course/GetCourseForDropdown",
            data: "{}",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                courseDropdown.empty().append('<option selected="selected" value="0">Search Course</option>');
                $.each(data, function () {
                    courseDropdown.append($("<option></option>").val(this['id']).html(this['title']));
                });
            }
        });
    });
</script>
